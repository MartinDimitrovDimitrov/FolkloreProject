<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Folktales Browser</title>

    <!-- DataTables -->
    <link rel="stylesheet"
          href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>

    <style>
      body{font-family:Arial,Helvetica,sans-serif;margin:25px;}
      #selected-panel{border:1px solid #ccc;padding:12px;margin-top:20px;}
      #selected-panel h3{margin-top:0;}
      .btn{padding:6px 12px;border:1px solid #444;background:#eee;cursor:pointer;margin-right:8px;}

      .legend-placeholder {
        border: 2px dashed #ccc;
        height: 40px;
        background: #f9f9f9;
        }

        .drag-handle {
        cursor: grab;
        user-select: none;
        color: #666;
        font-weight: bold;
        }

        .drag-handle:hover {
        color: #000;
        }

        #filters-list {
        display: block;
        margin-top: 12px;
        }

        .filter-block {
        display: block;
        margin-top: 10px;
        }
    </style>
</head>
<body>

<h1>Folktales</h1>

<div id="filters-container" style="margin-top:20px; margin-bottom:20px;">
  <label style="display:block; margin-top: 10px; margin-bottom: 10px;">
  <input type="checkbox" id="show-only-selected">
  Show only selected tales
  </label>

  <button id="add-filter">+ Add Filter</button>
  <div id="filters-list"></div>
</div>

<table id="tales-table" class="display">
  <thead>
    <tr>
      <th>#</th>                           <!-- Row number -->
      <th><input type="checkbox" id="select-all-visible"></th> <!-- Checkbox -->
      <th>Title</th>
      <th>Culture Group</th>
      <th>Collector</th>
      <th>Year</th>
      <th>Source</th>
      <th>Link</th>
      <th>Notes</th>
    </tr>
  </thead>

  <tbody>
    {% for t in tales %}
    <tr>
    <td></td>  <!-- ← This will be filled with the row number -->
    <td>
      <input type="checkbox"
            class="row-check"
            data-taleid="{{ t.tale_id }}"
            data-title="{{ t.title }}"
            data-culture="{{ t.culture_group }}"
            data-collector="{{ t.collector }}"
            data-year="{{ t.year_collected }}"
            data-source="{{ t.source }}"
            data-link="{{ t.link }}"
            data-notes="{{ t.notes }}"
            data-lat="{{ t.lat }}"
            data-lon="{{ t.lon }}"
            data-location="{{ t.location_name }}">
    </td>
    <td><a href="/tale/{{ t.tale_id }}" target="_blank" rel="noopener noreferrer">{{ t.title }}</a></td>
    <td>{{ t.culture_group }}</td>
    <td>{{ t.collector }}</td>
    <td>{{ t.year_collected }}</td>
    <td>
      {% if t.source_title %}
        {{ t.source_title }}{% if t.source_page %}, p. {{ t.source_page }}{% endif %}
      {% else %}
        –
      {% endif %}
    </td>
    <td>
      {% if t.source_link %}
        <a href="{{ t.source_link }}" target="_blank">Link</a>
      {% endif %}
    </td>
    <td>{{ t.notes }}</td>
  </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Selected tales panel -->
<div id="selected-panel" style="border:1px solid #ccc; padding:12px; margin-top:20px;">
  <h3 style="margin-top:0;">Selected Tales</h3>
  <p><b id="sel-count">0</b> tale(s) selected
    <button id="unselect-all">Unselect All</button>
  </p>
    
  <div id="sel-info">(no tales selected)</div>

  <!-- Style Controls -->
  <div id="style-controls" style="margin-top: 10px; display: none;">
    <label for="pin-color">Color: </label>
    <select id="pin-color">
      <option value="blue">Blue</option>
      <option value="red">Red</option>
      <option value="green">Green</option>
      <option value="orange">Orange</option>
      <option value="purple">Purple</option>
      <option value="brown">Brown</option>
      <option value="black">Black</option>
      <option value="gray">Gray</option>
    </select>

    <label for="pin-shape" style="margin-left:10px;">Shape: </label>
    <select id="pin-shape">
      <option value="circle">Circle</option>
      <option value="square">Square</option>
      <option value="triangle">Triangle</option>
      <option value="star">Star</option>
    </select>

    <div style="margin-top: 10px;">
        <button id="add-map">Add to Map</button>
        <button id="remove-map">Remove from Map</button>
    </div>
  </div>
</div>

<!-- Map container -->
<div id="map-container" style="margin-top:30px;">
  <h2>Map</h2>
  <div style="margin-top: 10px; margin-bottom: 12px;">
    <button id="clear-map">Clear Map</button>
    <button id="select-map">Select All on Map</button>
  </div>
  <div id="map" style="height: 500px; border: 1px solid #ccc;"></div>
</div>

<div id="legend" style="margin-top: 20px; border: 1px solid #ccc; padding: 10px;">
  <h3>Legend</h3>
  <button id="clear-legend">Clear Legend</button>
  <small style="color:#666; margin-bottom: 10px; margin-top: 10px; display: block;">
    Drag <span style="font-weight:bold;">≡</span> to reorder styles. Deleting a style is possible only if it is not used on the map.
  </small>
  <ul id="legend-list" style="list-style: none; padding: 0;"></ul>
    <div id="add-pin-style" style="margin-top: 10px; border-top: 1px solid #ccc; padding-top: 10px;">
        <h4>Add New Pin Style</h4>
        <label for="new-pin-color">Color:</label>
        <select id="new-pin-color">
            <option value="blue">Blue</option>
            <option value="red">Red</option>
            <option value="green">Green</option>
            <option value="orange">Orange</option>
            <option value="purple">Purple</option>
            <option value="brown">Brown</option>
            <option value="black">Black</option>
            <option value="gray">Gray</option>
        </select>

        <label for="new-pin-shape" style="margin-left:10px;">Shape:</label>
        <select id="new-pin-shape">
            <option value="circle">Circle</option>
            <option value="square">Square</option>
            <option value="triangle">Triangle</option>
            <option value="star">Star</option>
        </select>

        <button id="add-new-style" style="margin-left: 10px;">Add</button>
    </div>
  </div>
</div>

<!-- Leaflet CSS/JS -->
<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>
<script
  src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js">
</script>

<script src="static/folktales.js"></script>

</body>
</html>